<div class='position-relative' style="flex: 1 1 auto;">
	<gsim-map @gsim-selected="(gs) => { forms.trellis.gsim = Array.from(new Set(forms.trellis.gsim.concat(gs))); }"
			  @gsim-unselected="(gs) => { forms.trellis.gsim = forms.trellis.gsim.filter(g => !gs.includes(g)); }"
			  :regionalizations="regionalizations"
			  :region-selected-url="urls.get_gsim_from_region"
			  style='position:absolute;inset:0px;z-index:0'>
	</gsim-map>
	<form novalidate @submit.prevent="downloadResult(urls.trellis, forms.trellis, 'egsim-predictions')"
		  class='d-flex flex-column p-3' style='position:absolute;top:0px;max-height:100%;z-index:1'>

		<gsim-select :selected-model-names="forms.trellis.gsim"
					 :models="models"
					 :selected-imts="forms.trellis.imt"
					 style="flex: 0 1 auto; min-height:0px">
		</gsim-select>

		<imt-select :selected-imts="forms.trellis.imt" :imts='imts' class='mt-3'></imt-select>

		<div class='d-flex flex-column mt-3'>
			<div class='input-group'>
				<label class="input-group-text">magnitude</label>
				<array-input v-model="forms.trellis.magnitude"></array-input>
				<button
					class="btn border bg-white" type="button" style='border-left-width:0 !important'
					data-bs-toggle="collapse" data-bs-target="#rupture-controls"></button>
			</div>
		</div>

		<div id='rupture-controls' class="collapse" style='max-height:8rem;overflow:scroll'>
			<div class="input-group mt-1">
				<div class='input-group-text'>aspect</div>
				<input type='number' v-model="forms.trellis['aspect']"
					   required min="0.0" step="any" class='form-control' />
			</div>

			<div class="input-group mt-1">
				<div class='input-group-text'>dip</div>
				<input type="number" v-model="forms.trellis['dip']"
					   min="0.0" max="90.0" step="any" class='form-control' />
			</div>

			<div class="input-group mt-1">
				<div class='input-group-text'>hypocenter-location</div>
				<array-input v-model="forms.trellis['hypocenter-location']" />
			</div>

			<div class="input-group mt-1">
				<div class='input-group-text'>initial-point</div>
				<array-input v-model="forms.trellis['initial-point']" />
			</div>

			<div class="input-group mt-1">
				<div class='input-group-text'>msr</div>
				<select v-model="forms.trellis['msr']" class='form-control'>
					<option v-for="m in forms.misc.msr" :value="m[0]">
						{% verbatim %}{{ m[1] }}{% endverbatim %}
					</option>
				</select>
			</div>

			<div class="input-group mt-1">
				<div class='input-group-text'>rake</div>
				<input type='number' v-model="forms.trellis['rake']"
					   min="-180.0" max="180.0" step="any" class='form-control' />
			</div>

			<div class="input-group mt-1">
				<div class='input-group-text'>strike</div>
				<input type="number" v-model="forms.trellis['strike']"
					   min="0.0" max="360.0" step="any" class='form-control' />
			</div>

			<div class="input-group mt-1">
				<div class='input-group-text'>ztor</div>
				<input type="number" v-model="forms.trellis['ztor']"
					   min="0.0" step="any" class='form-control' />
			</div>
		</div>

		<div class='d-flex flex-column mt-3'>
			<div class='input-group'>
				<label class="input-group-text">distance</label>
				<array-input v-model="forms.trellis.distance"></array-input>
				<button class="btn border bg-white" type="button" style='border-left-width:0 !important'
						data-bs-toggle="collapse" data-bs-target="#site-controls"></button>
			</div>
		</div>

		<div id='site-controls' class="collapse" style='max-height:8rem;overflow:scroll'>

			<div class="input-group mt-1">
				<label class='input-group-text' style='width:100%'>
					<input type='checkbox' v-model="forms.trellis.backarc" class='me-1' />
					backarc
				</label>
			</div>

			<div class="input-group mt-1">
				<div class='input-group-text'>line-azimuth</div>
				<input type='number' v-model="forms.trellis['line-azimuth']"
					   min="0" max="360.0" step="any" class='form-control' />
			</div>

			<div class="input-group mt-1">
				<div class='input-group-text'>region</div>
				<select v-model="forms.trellis.region" class='form-control'>
					<option v-for="m in forms.misc.region" :value="m[0]">{% verbatim %}{{ m[1] }}{% endverbatim %}</option>
				</select>
			</div>

			<div class="input-group mt-1">
				<div class='input-group-text'>vs30</div>
				<input type='number' v-model="forms.trellis.vs30"
					   step="any" class='form-control' />
			</div>

			<div class="input-group mt-1">
				<label class='input-group-text' style='width:100%'>
					<input type='checkbox' v-model="forms.trellis.vs30measured" class='me-1' />
					vs30measured
				</label>
			</div>

			<div class="input-group mt-1">
				<div class='input-group-text'>z1</div>
				<!-- implement v-model "natively" because we need to convert empty inputs to null: -->
				<input type='number'
					   :value="forms.trellis.z1"
					   @input="forms.trellis.z1 = $event.target.value.trim() ? $event.target.value : null"
					   class='form-control' />
			</div>

			<div class="input-group mt-1">
				<div class='input-group-text'>z2pt5</div>
				 <!-- implement v-model "natively" because we need to convert empty inputs to null: -->
				<input type='number'
					   :value="forms.trellis.z2pt5"
					   @input="forms.trellis.z2pt5 = $event.target.value.trim() ? $event.target.value : null"
					   step="any" class='form-control' />
			</div>

		</div>

		<select v-model='forms.trellis.format'>
			<option v-for='format in forms.misc.download_formats' :value='format'>
				{% verbatim %}{{ format }}{% endverbatim %}
			</option>
		</select>
		<button type='submit'><i class='fa fa-download'></i> Compute</button>
	</form>

<!--	<trellis-plot-div :data="responseData"-->
<!--					  class='invisible position-absolute start-0 top-0 end-0 bottom-0'-->
<!--					  :style="{visibility: Object.keys(responseData).length ? 'visible !important' : '', 'z-index':1}">-->
<!--	</trellis-plot-div>-->
</div>