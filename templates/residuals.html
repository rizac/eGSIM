<div class='position-relative' style="flex: 1 1 auto;">
	<gsim-map @gsim-selected="(gs) => { forms.residuals.gsim = Array.from(new Set(forms.residuals.gsim.concat(gs))) }"
			  @gsim-unselected="(gs) => { forms.residuals.gsim = forms.residuals.gsim.filter(g => !gs.includes(g)); }"
			  :regionalizations="regionalizations"
			  :region-selected-url="urls.get_gsim_from_region"
			  style='position:absolute;inset:0px;z-index:0'>
	</gsim-map>

	<form novalidate @submit.prevent=""
		  class='d-flex flex-column p-3' style='position:absolute;top:0px;max-height:100%;z-index:1'>

		<gsim-select v-model="forms.residuals.gsim"
					 :models="models"
					 :selected-imts="forms.residuals.imt"
					 style="flex: 0 1 auto; min-height:0px">
		</gsim-select>

		<imt-select v-model="forms.residuals.imt" :imts='imts' class='mt-3'></imt-select>

		<flatfile-select
			class= 'mt-3'
			:flatfiles='flatfiles'
			v-model="forms.residuals.flatfile"
			:upload-url='urls.flatfile_validation'
			@update:model-value="(value) => { forms.misc.residuals.selected_flatfile_fields=flatfiles[flatfiles.map(f => f.name).indexOf(value.name || value)].columns; }"
		>
		</flatfile-select>

		<div class='input-group mt-1'>
			<label class='input-group-text'>data-query</label>
			<input type='text' v-model="forms.residuals['data-query']" class='form-control'/>
		</div>

		<div class='d-flex flex-column mt-3 align-items-stretch'>

			<div class="input-group-text d-flex flex-row"
				 style="border-bottom: 0px !important; border-bottom-left-radius: 0px !important; border-bottom-right-radius: 0px !important;">
				<span>Compute residuals</span>
				<span style='flex:1 1 auto'></span>
				<label><input type='checkbox' v-model="forms.residuals.likelihood" class='me-1' />include likelihood</label>
				<a href="https://doi.org/10.1785/0120030147" target='_blank' class='ms-2'><i class='fa fa-external-link'></i></a>
			</div>

			<div class='d-flex flex-row form-control'
				 style="border-top-left-radius: 0px !important; border-top-right-radius: 0px !important;">

				<div class='input-group me-2'>
					<select v-model='forms.residuals.format' class='form-control'>
						<option v-for='format in forms.misc.download_formats' :value='format'>
							{% verbatim %}{{ format }}{% endverbatim %}
						</option>
					</select>
					<button type='button'
							@click="downloadResult(urls.residuals, forms.residuals, 'egsim-residuals')"
							class='btn btn-primary text-nowrap'
							title='Download residuals'>
						<i class='fa fa-download'></i>
					</button>
					<button type='button'
							onclick='var elm=document.getElementById("residuals_tutorial"); elm.src=elm.getAttribute("data-src");elm.classList.toggle("d-none")'
							class='btn btn-light border'
							style='border-left: 0px !important;'>
						<img style="height:1.5rem" src="{% static 'img/logos/jupyter.svg' %}" />
					</button>
				</div>

				<div class='input-group me-2'>
					<select v-model='forms.misc.residuals.plot_x' class='form-control'>
						<option :value='null'>
							{% verbatim %}
							{{ forms.residuals.likelihood ? 'Likelihood' : 'Residuals' }} histogram (density distribution)
							{% endverbatim %}
						</option>
						<option v-for='f in forms.misc.residuals.selected_flatfile_fields.filter(f => !f.type.toLowerCase().includes("intensity"))' :value='f.name'>
							{% verbatim %}
							{{ forms.residuals.likelihood ? 'Likelihood' : 'Residuals' }} vs. {{ f.name + " (" + f.dtype + ")" }}
							{% endverbatim %}
						</option>
					</select>
					<button type='button'
							@click="var data = Object.assign({}, forms.residuals, forms.misc.residuals); postData(urls.residuals_plot, data)"
							class='btn btn-primary text-nowrap'
							title='Visualize residuals via interactive plots'>
						<i class='fa fa-bar-chart'></i>
					</button>
				</div>

			</div>

		</div>

	</form>

	<iframe id='residuals_tutorial'
			class='p-3 bg-white d-none position-absolute border-0 shadow' style='width:50vw; height: 100%; right:0'
			:data-src=urls.residuals_response_tutorial>
	</iframe>
<!--	<residuals-plot-div :data="responseData"-->
<!--						class='invisible'-->
<!--						style='position:absolute;inset:0px;z-index:10'-->
<!--						:style="{visibility: Object.keys(responseData).length ? 'visible !important' : ''}">-->
<!--	</residuals-plot-div>-->
</div>